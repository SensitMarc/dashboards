<!DOCTYPE html>
<html>
<head>
  <title>Energy &raquo; usage</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <link rel="stylesheet" type="text/css" href="../../assets/lib/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../assets/css/keen-dashboards.css" />

<meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.0/mapbox-gl.css' rel='stylesheet' />

</head>
<body>
  
  <div class="container-fluid">

    <div class="row">
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Cell title
          </div>
          <div class="chart-stage">
            <div id="mychart">
          </div>
           </div>
            <div class="chart-notes">
            kWhr
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Cell Title
          </div>
          <div class="chart-stage">
            <div id="mychartt">
          </div>
           </div>
            <div class="chart-notes">
            Notes about this chart
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Cell Title
          </div>
          <div class="chart-stage">
          <div id="lastmonthchart">
          </div>
          </div>
          <div class="chart-notes">
            Notes about this chart
          </div>
        </div>
      </div>
          </div>
<!-- end of three -->
      
<div class="row">
      <div class="col-sm-8">
        <div class="chart-wrapper">
          <div class="chart-title">
            Cell Title
          </div>
          <div class="chart-stage">
            <div id="state">
            </div>
          </div>
          <div class="chart-notes">
            Notes about this chart
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Cell Title
          </div>
          <div class="chart-stage">
            <div id="mycharttt">
            </div>
          </div>
          <div class="chart-notes">
            Notes about this chart
          </div>
        </div>
      </div>
  </div>
    
  <div class="row">
      <div class="col-sm-8">
        <div class="chart-wrapper">
          <div class="chart-title">
            Cell Title
          </div>
          <div class="chart-stage">
            <div id="visitors-uniques">
            </div>
          </div>
          <div class="chart-notes">
            Notes about this chart
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Cell Title
          </div>
          <div class="chart-stage">
            <div id="EFF">
            </div>
          </div>
          <div class="chart-notes">
            Notes about this chart
          </div>
        </div>
      </div>
    
      <hr>

<p class="small text-muted">   Built with &#9829; by <a href="http://sensee.ca">sensee.ca</a></p>

  </div>


  <script type="text/javascript" src="../../assets/lib/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="../../assets/lib/bootstrap/dist/js/bootstrap.min.js"></script>

  <script type="text/javascript" src="../../assets/lib/holderjs/holder.js"></script>
  <script>
    Holder.add_theme("white", { background:"#fff", foreground:"#a7a7a7", size:10 });
  </script>

  <script type="text/javascript" src="../../assets/lib/keen-js/dist/keen.min.js"></script>
  <script type="text/javascript" src="../../assets/js/meta.js"></script>

<script>
var client = new Keen({
  projectId: "563a13c896773d4a75c3bf93",
  readKey: "9d45d36b3d3040533eb3a9f2e8bcc9e317d6b4e7e2cbb413ce959e7c0f8b926a7b82523fc0acd774ef024a0f4bddcc2bd8e992e2f61d9aed7b7f09bcb63bc0a1ebee2e0ebd0e2792dba3dc4ae1ae9c11c19e54753574a726dea4eec16e463aa06196d6876d167a9d668f236f25a8857d"
});
  
Keen.ready(function(){
  
  var today = new Keen.Query("count", {
    eventCollection: "kWhr",
    filters: [
    {
        "operator": "eq",
        "property_name": "coreid",
        "property_value": "48ff6e065067555013541287"
    }
],
    timeframe: "this_1_days",
    timezone: "America/Sao_Paulo"
  });
  
    
  var month = new Keen.Query("count", {
    eventCollection: "kWhr",
    filters: [
    {
        "operator": "eq",
        "property_name": "coreid",
        "property_value": "48ff6e065067555013541287"
    }
],
    timeframe: "this_1_months",
    timezone: "America/Sao_Paulo"
  });
  
    var lastmonth = new Keen.Query("count", {
    eventCollection: "kWhr",
    filters: [
    {
        "operator": "eq",
        "property_name": "coreid",
        "property_value": "48ff6e065067555013541287"
    }
],
    timeframe: "previous_1_months",
    timezone: "America/Sao_Paulo"
  });
  
    var monthchart = new Keen.Query("count", {
    eventCollection: "kWhr",
          filters: [
    {
        "operator": "eq",
        "property_name": "coreid",
        "property_value": "48ff6e065067555013541287"
    }],
      
    interval:"daily",
    timeframe: "this_2_weeks",
    timezone: "America/Sao_Paulo"
  });
  
      var queryhourlykwhr = new Keen.Query("count", {
    eventCollection: "kWhr",
        groupBy: [
    "event"
],
    filters: [
    {
        "operator": "eq",
        "property_name": "coreid",
        "property_value": "48ff6e065067555013541287"
    }
],
    interval: "hourly",
    timeframe: "this_1_days",
    timezone: "America/Sao_Paulo"
  });
  
  var cycle = new Keen.Query("count_unique", {
    eventCollection: "collect",
    targetProperty: "event",
    filters: [
    {
        "operator": "eq",
        "property_name": "coreid",
        "property_value": "48ff6e065067555013541287"
        
    }
],
    timeframe: "this_1_days",
    timezone: "America/Sao_Paulo"
  });
  
  var state = new Keen.Query("count", {
    eventCollection: "kWhr",
              filters: [
    {
        "operator": "eq",
        "property_name": "coreid",
        "property_value": "48ff6e065067555013541287"
    }],
    
    groupBy: [
    "event"
],
    interval: "hourly",
    timeframe: "this_1_days",
    timezone: "America/Sao_Paulo"
  });
  
  var cycle = new Keen.Query("count", {
    eventCollection: "sensee",
    filters: [
    {
        "operator": "eq",
        "property_name": "event",
        "property_value": "on"
    }
],
    timeframe: "this_1_days",
    timezone: "America/Sao_Paulo"
  });
  
    var leader = new Keen.Query("count", {
    eventCollection: "sensee",
    filters: [
    {
        "operator": "eq",
        "property_name": "event",
        "property_value": "name"
    }
],
    groupBy: [
    "data"
],
    timeframe: "this_1_months",
    timezone: "America/Sao_Paulo"
  });
  
  var temperature = new Keen.Query("maximum", {
    eventCollection: "kWhr",
    interval: "hourly",
    targetProperty: "temperature",
    timeframe: "this_1_days",
    timezone: "America/Sao_Paulo"
  });
    
  
       // and draw a column chart
     client.draw(today, document.getElementById("mychart"), {
        chartType: "metric",
        title: "today",
        height: "250",
        width: "auto",
        chartOptions: {
          chartOptions: {
            isStacked: true
          }
        }
      });
      
      client.draw(month, document.getElementById("mychartt"), {
        chartType: "metric",
        title: "this month",
        height: "250",
        width: "auto",
          chartOptions: {
            chartOptions: {
            isStacked: true
          }
        }
      });
      
        client.draw(lastmonth, document.getElementById("lastmonthchart"), {
        chartType: "metric",
        title: "last month",
        height: "250",
        width: "auto",
          chartOptions: {
            chartOptions: {
            isStacked: true
          }
        }
      });
  
      client.draw(cycle, document.getElementById("cycle"), {
        chartType: "metric",
        title: "today",
        height: "250",
        width: "auto",
          chartOptions: {
            chartOptions: {
            isStacked: true
          }
        }
      });      
      client.draw(monthchart, document.getElementById("mycharttt"), {
        chartType: "columnchart",
        title: "daily",
        height: "250",
        width: "auto",
          chartOptions: {
            chartOptions: {
            isStacked: true
          }
        }
      });
client.draw(queryhourlykwhr, document.getElementById("hourlykwhr"), {
  chartType: "columnchart",
  title: "hourly",
  height: "250",
  width: "auto",
  chartOptions: {
     chartOptions: {
      isStacked: true
          }
  }
  });
  
client.draw(leader, document.getElementById("leader"), {
  chartType: "barchart",
  title: "last 30 days",
  height: "250",
  width: "auto",
  chartOptions: {
     chartOptions: {
      isStacked: true
          }
  }
  });
  
  
  client.draw(state, document.getElementById("state"), {
        chartType: "columnchart",
       title: "kWhr", 
        height: "250",
        width: "auto",
          chartOptions: {
            chartOptions: {
            isStacked: true
          }
        }
      });

  
  client.draw(temperature, document.getElementById("temperature"), {
        chartType: "linechart",
       title: "Temperature outside", 
        height: "250",
        width: "auto",
          chartOptions: {
            chartOptions: {
            isStacked: true
          }
        }
      });
});

Keen.ready(function(){
  // use a variable to ensure timeframe & interval for both queries match
  var interval = "hourly"
  var timeframe = "this_1_days"

  var pageviews = new Keen.Query("count", { // first query
    event_collection: "kWhr",
    interval: interval,
    timeframe: timeframe,
    timezone: "America/Sao_Paulo"
  });
  
  var uniqueVisitors = new Keen.Query("maximum", { // second query
    event_collection: "temp",
    target_property: "temperature",
    interval: interval,
    timeframe: timeframe,
    timezone: "America/Sao_Paulo"
  });

  var chart = new Keen.Dataviz()
    .el(document.getElementById("visitors-uniques"))
    .chartType("columnchart")
    .width("auto")
    .chartOptions({
                  vAxis:{ 
              minValue: "auto",
              maxValue: "auto"
               },
        chartOptions: {
            isStacked: true,
          }
    })
    .prepare();

  client.run([pageviews, uniqueVisitors], function(err, res){ // run the queries

    var result1 = res[0].result  // data from first query
    var result2 = res[1].result  // data from second query
    var data = []  // place for combined results
    var i=0
    
    while (i < result1.length) {

        data[i]={ // format the data so it can be charted
            timeframe: result1[i]["timeframe"],
            value: [
                { category: "kWhr", result: result1[i]["value"] },
                { category: "Outside temp", result: result2[i]["value"] }
            ]
        }
        if (i == result1.length-1) { // chart the data
        chart
          .parseRawData({ result: data })
          .render();
        }
        i++;
    }
  });
 
});
 
  Keen.ready(function(){
  // use a variable to ensure timeframe & interval for both queries match
  var interval = "hourly"
  var timeframe = "this_1_days"

  var pageviews = new Keen.Query("count", { // first query
    event_collection: "kWhr",
    interval: interval,
    timeframe: timeframe,
    timezone: "America/Sao_Paulo"
  });
  
  var uniqueVisitors = new Keen.Query("maximum", { // second query
    event_collection: "temp",
    target_property: "temperature",
    interval: interval,
    timeframe: timeframe,
    timezone: "America/Sao_Paulo"
  });

  var chart = new Keen.Dataviz()
    .el(document.getElementById("EFF"))
    .chartType("columnchart")
    .width("auto")
    .chartOptions({
                  vAxis:{ 
              minValue: "auto",
              maxValue: "auto"
               },
        chartOptions: {
            isStacked: true,
          }
    })
    .prepare();

  client.run([pageviews, uniqueVisitors], function(err, res){ // run the queries

    var result1 = res[0].result  // data from first query
    var result2 = res[1].result  // data from second query
    var data = []  // place for combined results
    var i=0
    
    while (i < result1.length) {

        data[i]={ // format the data so it can be charted
            timeframe: result1[i]["timeframe"],
        value: [
          { category: "Efficiency", result:  Math.abs(20-result2[i]["value"]) - result1[i]["value"] / Math.abs(20-result2[i]["value"]) }
        ]
        }
        if (i == result1.length-1) { // chart the data
        chart
          .parseRawData({ result: data })
          .render();
        }
        i++;
    }
  });
 
});
      
</script>

<div id='map'></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoic2Vuc2l0IiwiYSI6ImNpZ2hwb2VlbTgzbjJ2OG03ZmhweGNqZzAifQ.YCcLyhXq7MXpRJDXojNtCg';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v9',
    center: [75, 56],
    zoom: 1
});
map.on('load', function () {
    map.addSource("markers", {
        "type": "geojson",
        "data": {
            "type": "FeatureCollection",
            "features": [{
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-66.4619, 46.5653]
                },
                "properties": {
                    "title": "1340",
                    "marker-symbol": "rocket"
                }
            }, {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-106.3468, 55.1304]
                },
                "properties": {
                    "title": "900",
                    "marker-symbol": "rocket"
                   
                }
            }]
        }
    });
    map.addLayer({
        "id": "markers",
        "type": "symbol",
        "source": "markers",
        "layout": {
            "icon-image": "{marker-symbol}-15",
            "text-field": "{title}",
            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
            "text-offset": [0, 0.6],
            "text-anchor": "top"
        }
    });
});
</script>
<script type='text/javascript' data-cfasync='false'>window.purechatApi = { l: [], t: [], on: function () { this.l.push(arguments); } }; (function () { var done = false; var script = document.createElement('script'); script.async = true; script.type = 'text/javascript'; script.src = 'https://app.purechat.com/VisitorWidget/WidgetScript'; document.getElementsByTagName('HEAD').item(0).appendChild(script); script.onreadystatechange = script.onload = function (e) { if (!done && (!this.readyState || this.readyState == 'loaded' || this.readyState == 'complete')) { var w = new PCWidget({c: '8313721e-7e2d-4667-85b2-e5a6c8daa40f', f: true }); done = true; } }; })();</script>
</body>
</html>
